/*
 2015-2020 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,d){a instanceof String&&(a=String(a));for(var c=a.length,b=0;b<c;b++){var g=a[b];if(e.call(d,g,b,a))return{i:b,v:g}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,d){if(a==Array.prototype||a==Object.prototype)return a;a[e]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<a.length;++e){var d=a[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,e){var d=$jscomp.propertyToPolyfillSymbol[e];if(null==d)return a[e];d=a[d];return void 0!==d?d:a[e]};
$jscomp.polyfill=function(a,e,d,c){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,e,d,c):$jscomp.polyfillUnisolated(a,e,d,c))};$jscomp.polyfillUnisolated=function(a,e,d,c){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var b=a[c];b in d||(d[b]={});d=d[b]}a=a[a.length-1];c=d[a];e=e(c);e!=c&&null!=e&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(a,e,d,c){var b=a.split(".");a=1===b.length;c=b[0];c=!a&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<b.length-1;g++){var f=b[g];f in c||(c[f]={});c=c[f]}b=b[b.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?c[b]:null;e=e(d);null!=e&&(a?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:e}):e!==d&&($jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(b):$jscomp.POLYFILL_PREFIX+b,b=$jscomp.propertyToPolyfillSymbol[b],
$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:e})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
(function(a,e){var d=0;a.widget("s3.groupedItems",{options:{ajaxURL:null,renderGroupHeaders:!1,totalsLabel:"TOTAL"},_create:function(){a(this.element);this.id=d;d+=1;this.eventNamespace=".groupeditems"},_init:function(){var c=a(this.element);this.widget_id=c.attr("id");this.items=c.find(".gi-data").first();this.refresh()},_destroy:function(){a.Widget.prototype.destroy.call(this)},refresh:function(){var c=a(this.element);c.find(".gi-throbber").show();this._unbindEvents();this.data||this._deserialize();
var b=this.data,g=c.find(".gi-table");b.e?(g.hide(),g.empty(),c.find(".gi-empty").show()):(c.find(".gi-empty").hide(),g.empty(),b=this._renderTable(b),g.append(b).show());this._bindEvents();c.find(".gi-throbber").css("visibility","hidden")},_renderTable:function(c){var b=a('<table class="groupeditems">');this._renderTableHeader(c).appendTo(b);this._renderGroup(b,c);this._renderTableFooter(c).appendTo(b);return b},_renderTableHeader:function(c){var b=a("<thead>"),g=a('<tr class="gi-column-headers">').appendTo(b),
f=c.c;c=c.l;for(var d,r=0,e=f.length;r<e;r++)d=c[f[r]],a("<th>").html(d).appendTo(g);return b},_renderTableFooter:function(c){var b=this.options,g=a("<tfoot>"),f=a('<tr class="gi-column-totals">'),d=c.t,e=!1;for(k in d){e=!0;break}if(e){c=c.c;for(var l=null,h=0,p=0,n=c.length;p<n;p++){if(!l){if(!d.hasOwnProperty(c[p])){h++;continue}1<h&&(l=a('<td class="gi-column-totals-label" colspan="'+h+'">'),a("<span> "+b.totalsLabel+"</span>").appendTo(l),l.appendTo(f))}var k=a("<td>").appendTo(f);(e=d[c[p]])&&
k.html(e)}f.appendTo(g)}return g},_renderGroup:function(c,b,a,f){"undefined"==typeof a&&(a=b);"undefined"==typeof f&&(f=0);this.options.renderGroupHeaders&&0<f&&this._renderGroupHeader(c,b,a,f);var g=a.d,d=a.i,e;if(g){var h=0;for(e=g.length;h<e;h++)this._renderGroup(c,b,g[h],f+1)}else if(d)for(h=0,e=d.length;h<e;h++)this._renderItem(c,b,d[h],f);0<f&&this._renderGroupFooter(c,b,a,f)},_renderGroupHeader:function(c,b,g,f){b=b.c;g=g.v;f=a('<tr class="gi-group-header gi-level-'+f+'">');a('<td colspan="'+
b.length+'">').html(g).appendTo(f);f.appendTo(c)},_renderGroupFooter:function(c,b,g,f){var d=this.options,e=g.t,l=!1;for(h in e){l=!0;break}b=b.c;g=g.v;f=a('<tr class="gi-group-footer gi-level-'+f+'">');if(!l&&!d.renderGroupHeaders)a('<td colspan="'+b.length+'">').html(g).appendTo(f),f.appendTo(c);else if(l){l=0;var h=null;for(var p,n,k=0,m=b.length;k<m;k++){if(!h){if(!e.hasOwnProperty(b[k])){l++;continue}1<l&&(h=a('<td class="gi-group-footer-label" colspan="'+l+'">'),d.renderGroupHeaders||h.html(g),
a('<span class="gi-group-footer-inline-label"> '+d.totalsLabel+"</span>").appendTo(h),h.appendTo(f))}n=a("<td>").appendTo(f);(p=e[b[k]])&&n.html(p)}f.appendTo(c)}},_renderItem:function(c,b,g,d){d=a('<tr class="gi-item gi-level-'+d+'">');b=b.c;for(var e,f,l=0,h=b.length;l<h;l++)f=a("<td>"),(e=g[b[l]])&&f.html(e),f.appendTo(d);d.appendTo(c)},reload:function(c,b,d){d="undefined"!=typeof d?d:!0;"undefined"==typeof b&&(b=this._getFilters());var e=this,g=!1;a(this.element).find(".gi-throbber").css("visibility",
"visible");if(c||b)g=this._updateAjaxURL(c,b);g||d?a.ajax({url:this.options.ajaxURL,dataType:"json"}).done(function(a){e.items.val(JSON.stringify(a));e.data=null;e.refresh()}).fail(function(a,c,b){msg="UNAUTHORIZED"==b?i18n.gis_requires_login:a.responseText;console.log(msg)}):e.refresh()},_getFilters:function(){var c=a("#"+this.widget_id+"-filter-form");try{return c.length?S3.search.getCurrentFilters(c.first()):null}catch(b){return null}},_updateAjaxURL:function(c,b){var d=this.options.ajaxURL;if(!d)return!1;
var e=d.split("?");if(1<e.length){var q=e[1];var r=q.split("&")}else r=[];var l=[];d=!1;if(c)for(var h in c)q=c[h],q=h+"="+q,d||-1!=a.inArray(q,r)||(d=!0),l.push(q);h={};q={};var p;if(b){var n=0;for(p=b.length;n<p;n++){var k=b[n];var m=k[0];k=k[1];null===k?h[m]||(q[m]=!0):(q[m]&&(q[m]=!1),k=m+"="+encodeURIComponent(k),h[m]?h[m].push(k):h[m]=[k])}}n=0;for(p=r.length;n<p;n++)k=r[n].split("="),1<k.length&&(m=decodeURIComponent(k[0]),k=decodeURIComponent(k[1]),q[m]?d=!0:h[m]?d||-1!=a.inArray(m+"="+k,
h[m])||(d=!0):c&&c.hasOwnProperty(m)||l.push(r[n]));for(m in h)for(n=0,p=h[m].length;n<p;n++)d||-1!=a.inArray(h[m][n],r)||(d=!0),l.push(h[m][n]);c=l.join("&");b=e[0];c&&(b=b+"?"+c);this.options.ajaxURL=b;return d},_serialize:function(){var a=this.items;if(a){var b="";this.data&&(b=JSON.stringify(this.data));a.val(b)}return b},_deserialize:function(){this.data={};var a=this.items;a&&(a=a.val())&&(this.data=JSON.parse(a));return this.data},_bindEvents:function(){var c=this;a(this.element).delegate(".gi-export",
"click"+this.eventNamespace,function(){var b=a(this).data("url"),d=c._getFilters();d&&(b=S3.search.filterURL(b,d));window.open(b)})},_unbindEvents:function(){a(this.element).undelegate(this.eventNamespace)}})})(jQuery);
