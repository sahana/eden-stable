/*
 2016-2020 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,d){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var e=a[c];if(f.call(d,e,c,a))return{i:c,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,d){if(a==Array.prototype||a==Object.prototype)return a;a[f]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var f=0;f<a.length;++f){var d=a[f];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,f){var d=$jscomp.propertyToPolyfillSymbol[f];if(null==d)return a[f];d=a[d];return void 0!==d?d:a[f]};
$jscomp.polyfill=function(a,f,d,b){f&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,f,d,b):$jscomp.polyfillUnisolated(a,f,d,b))};$jscomp.polyfillUnisolated=function(a,f,d,b){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];c in d||(d[c]={});d=d[c]}a=a[a.length-1];b=d[a];f=f(b);f!=b&&null!=f&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:f})};
$jscomp.polyfillIsolated=function(a,f,d,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var e=0;e<c.length-1;e++){var g=c[e];g in b||(b[g]={});b=b[g]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?b[c]:null;f=f(d);null!=f&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:f}):f!==d&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=$jscomp.propertyToPolyfillSymbol[c],
$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:f})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
(function(a,f){var d=0;a.widget("dvr.eventRegistration",{options:{tablename:"case_event",ajax:null,ajaxURL:"",showPicture:!0,showPictureText:"Show Picture",hidePictureText:"Hide Picture"},_create:function(){this.id=d;d+=1;this.eventNamespace=".eventRegistration"},_init:function(){this.idPrefix="#"+this.options.tablename;var b=a(this.element);this.flagInfo=b.find("input[type=hidden][name=flags]");this.permissionInfo=b.find("input[type=hidden][name=permitted]");this.actionableInfo=b.find("input[type=hidden][name=actionable]");
this.eventType=b.find('input[type="hidden"][name="event"]');this.blockingInfo=b.find('input[type="hidden"][name="intervals"]');this.actionDetails=b.find('input[type="hidden"][name="actions"]');this.imageURL=b.find('input[type="hidden"][name="image"]');this.blockedEvents=(b=this.blockingInfo.val())?JSON.parse(b):{};this.blockingMessage=null;this.refresh()},_destroy:function(){a.Widget.prototype.destroy.call(this)},refresh:function(){var b=this.options,c=this.idPrefix;this._unbindEvents();b.ajaxURL&&
null===b.ajax&&(b.ajax=!0);this._showFlagInfo();this._showProfilePicture();a(this.element).find(c+"_details__row .controls").addClass("has-details");this.actionDetails.length?JSON.parse(this.actionDetails.val()).length?this._showDetails(!0):this._hideDetails():this._hideDetails();this._checkBlockedEvents()||this._toggleSubmit(!1);b=a(c+"_label");b.focus().val(b.val());this._bindEvents()},_checkID:function(){this._clearAlert();a(this.element);var b=this.idPrefix,c=a(b+"_label"),e=c.val().trim();c.val(e);
if(e){c={l:e,c:!0};e=this.options.ajaxURL;var g=a(b+"_person__row .controls").empty(),d=a('<div class="inline-throbber">').insertAfter(g),h=this;this._removeProfilePicture();this._clearDetails();a.ajaxS3({url:e,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(c){d.remove();if(c.e)a('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+c.e+"</div></div>").hide().insertAfter(a(b+"_label")).slideDown();
else{g.html(c.p).removeClass("hide").show();var e=h.flagInfo;c.f?e.val(JSON.stringify(c.f)):e.val("[]");e=h.permissionInfo;c.s!==f?e.val(JSON.stringify(c.s)):e.val("false");e=h.actionableInfo;var l=c.u;e.length&&(l!==f?e.val(JSON.stringify(c.u)):(l=!0,e.val("true")));c.d&&h._updateDetails(c.d,l);c.b&&(h.imageURL.val(c.b),h._showProfilePicture());h.blockedEvents=c.i||{};h.blockingInfo.val(JSON.stringify(h.blockedEvents));h.eventType.val()&&h._toggleSubmit(!0);h._showFlagInfo()}c.a?S3.showAlert(c.a,
"error"):c.m&&S3.showAlert(c.m,"success")},error:function(){d.remove();h._clearForm(!0)}})}},_registerEvent:function(){this._clearAlert();var b=this.idPrefix,c=a(b+"_label").val(),e=this.eventType.val();if(c&&e){c={l:c,t:e};e=this.options.ajaxURL;var g=a(b+"_person__row .controls"),d=a('<div class="inline-throbber">').insertAfter(g),f=this;g=this.actionDetails;g.length&&(g=g.val(),c.d=g?JSON.parse(g):[]);c.c=a(b+"comments").val();a.ajaxS3({url:e,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",
data:JSON.stringify(c),success:function(c){d.remove();c.e?a('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+c.e+"</div></div>").hide().insertAfter(a(b+"_label")).slideDown():f._clearForm();c.a?S3.showAlert(c.a,"error",!1):c.m&&S3.showAlert(c.m,"success",!1)},error:function(){d.remove();this._clearForm(!0)}})}},_checkBlockedEvents:function(){var b=this.eventType.val();b=this.blockedEvents[b];this.blockingMessage&&this.blockingMessage.remove();if(b){var c=
a("<h6>").addClass("event-registration-blocked").html(b[0]);if(new Date(b[1])>new Date)return this.blockingMessage=a("<div>").addClass("small-12-columns").append(c).prependTo(a("#submit_record__row")),!1}return!0},_showFlagInfo:function(){var b=this.flagInfo,c=a(this.idPrefix+"_flaginfo__row .controls").empty();b=b.length?JSON.parse(b.val()):[];var e=b.length;if(e){c.addClass("has-flaginfo");c=a('<div class="checkpoint-advise">').hide().appendTo(c);for(var g,d,f=0;f<e;f++)g=b[f],d=a('<div class="checkpoint-instructions">').appendTo(c),
a("<h4>"+g.n+"</h4>").appendTo(d),g.i&&a("<p>"+g.i+"</p>").appendTo(d);c.slideDown()}},_showProfilePicture:function(){var b=a(this.element),c=this.options,e=this.imageURL.val();this._removeProfilePicture();if(e){var g=a('<button class="tiny secondary button toggle-picture" type="button">'),d=a('<div class="button-row">').append(g);g.text(c.showPictureText);a('<div class="panel profile-picture">').append(d).data("url",e).appendTo(b);c.showPicture&&this._togglePicture()}},_removeProfilePicture:function(){this.imageURL.val("");
a(this.element).find(".panel.profile-picture").remove()},_togglePicture:function(){var b=a(this.element),c=this.options;b=b.find(".panel.profile-picture");if(b.length){var e=b.find(".image-row"),g=b.data("url"),d=b.find("button.toggle-picture");e.length?(e.remove(),d.text(c.showPictureText)):g&&(e=a("<img>").attr("src",g),e=a('<div class="image-row">').append(e),b.prepend(e),d.text(c.hidePictureText))}},_hideDetails:function(){var b=this.idPrefix;a(b+"_person__row .controls").text()?a(b+"_details__row").show():
a(b+"_details__row").hide();a(b+"_date__row").hide();a(b+"_comments__row").hide()},_showDetails:function(b){var c=this.idPrefix;a(c+"_details__row").show();b&&(a(c+"_date__row").show(),a(c+"_comments__row").show())},_updateDetails:function(b,c){var e=this.idPrefix;a(e+"_details__row .controls");a(e+"_date__row .controls");var d=this.actionDetails;d.length&&(""!==b.h?d.val(JSON.stringify(b.h)):d.val("[]"));a(e+"_details__row .controls").html(b.d);a(e+"_date__row .controls").html(b.t);this._showDetails(c)},
_clearDetails:function(){var b=this.idPrefix;this._hideDetails();this.flagInfo.val("[]");this.permissionInfo.val("false");a(b+"_flaginfo__row .controls").empty();a(b+"_details__row .controls").empty();a(b+"_date__row .controls").empty();a(b+"_comments").val("");this.blockedEvents={};this.blockingMessage&&this.blockingMessage.remove();this.blockingInfo.val(JSON.stringify(this.blockedEvents))},_toggleSubmit:function(b){var c=a(this.element),e=[".check-btn",".submit-btn"],d=this.permissionInfo,f=this.actionableInfo;
if(b){var h=b=!1;d.length&&(d=d.val())&&(b=JSON.parse(d));b&&(h=!0,f.length&&(f=f.val())&&(h=JSON.parse(f)));b&&h&&(h=this._checkBlockedEvents());b&&h&&e.reverse()}d=c.find(e[0]);c.find(e[1]).prop("disabled",!0).hide().insertAfter(d);d.prop("disabled",!1).hide().removeClass("hide").show()},_clearAlert:function(){a(".alert-error, .alert-warning, .alert-info, .alert-success").fadeOut("fast");a(".error_wrapper").fadeOut("fast").remove()},_clearForm:function(b,c){var e=this.idPrefix;a(".inline-throbber").remove();
b||this._clearAlert();c||a(e+"_label").val("");a(e+"_person__row .controls").hide().empty();this._removeProfilePicture();this._clearDetails();this._toggleSubmit(!1)},_bindEvents:function(){var b=a(this.element),c=this.idPrefix,e=this.eventNamespace,d=this,f=a(".zxing-button"),h=a("#event-type-toggle"),k=a("#event-type-selector");-1==navigator.userAgent.toLowerCase().indexOf("android")?f.addClass("disabled").click(function(a){a.preventDefault();a.stopPropagation();return!1}):f.bind("click"+e,function(){d._clearAlert()});
h.bind("click"+e,function(){d._clearAlert();k.hasClass("hide")?k.hide().removeClass("hide").slideDown():k.slideToggle()});k.find("a.event-type-selector").bind("click"+e,function(){var b=a(this),e=b.data("code");b=b.data("name");a('input[type="hidden"][name="event"]').val(e);a(".event-type-name").text(b).removeClass("placeholder");a(c+"_person__row .controls").text()&&d._toggleSubmit(!0);f.each(function(){var b=a(this),c=b.data("tmp");c&&b.attr("href",c.replace("%7BEVENT%7D",e))});k.slideUp()});b.delegate(".toggle-picture",
"click"+e,function(a){a.preventDefault();d._togglePicture()});b.find("a.cancel-action").bind("click"+e,function(a){a.preventDefault();d._clearForm()});this.options.ajax&&(b.find(".check-btn").bind("click"+e,function(a){a.preventDefault();d._checkID()}),b.find(".submit-btn").unbind(e).bind("click"+e,function(a){a.preventDefault();d._registerEvent()}));b=a(c+"_label");b.bind("input"+e,function(a){d._clearForm(!1,!0)});b.bind("keyup"+e,function(a){switch(a.which){case 27:d._clearForm()}});return!0},
_unbindEvents:function(){var b=a(this.element),c=this.eventNamespace,d=this.idPrefix;a(".zxing-button").unbind(c).unbind("click");a("#event-type-toggle").unbind(c);a("#event-type-selector").find("a.event-type-selector").unbind(c);a(d+"_label").unbind(c);b.find("a.cancel-action").unbind(c);b.find(".check-btn").unbind(c);b.find(".submit-btn").unbind(c);b.undelegate(c);return!0}})})(jQuery);
