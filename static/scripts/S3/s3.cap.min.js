var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,d){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var f=a[c];if(e.call(d,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,d){if(a==Array.prototype||a==Object.prototype)return a;a[e]=d.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<a.length;++e){var d=a[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,e){var d=$jscomp.propertyToPolyfillSymbol[e];if(null==d)return a[e];d=a[d];return void 0!==d?d:a[e]};
$jscomp.polyfill=function(a,e,d,b){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,e,d,b):$jscomp.polyfillUnisolated(a,e,d,b))};$jscomp.polyfillUnisolated=function(a,e,d,b){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];c in d||(d[c]={});d=d[c]}a=a[a.length-1];b=d[a];e=e(b);e!=b&&null!=e&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(a,e,d,b){var c=a.split(".");a=1===c.length;b=c[0];b=!a&&b in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<c.length-1;f++){var p=c[f];p in b||(b[p]={});b=b[p]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?b[c]:null;e=e(d);null!=e&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:e}):e!==d&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=$jscomp.propertyToPolyfillSymbol[c],
$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:e})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,d){return $jscomp.findInternal(this,a,d).v}},"es6","es3");
(function(a,e){function d(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function b(){return 0<a(".cap_info_template_form").length}function c(a){return"cap_alert"==a?["codes","note","incidents"]:"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function f(e){function n(b,n){var m=d(e),k=c(m),f={};"undefined"==typeof n&&(n=!1);if(b)"cap_alert"==m?(l=b.$_cap_alert&&b.$_cap_alert[0]||{},f=a.parseJSON(l.template_settings)||{},a(".cap_alert_form").addClass("template_loaded")):"cap_info"==m&&(l=b.$_cap_info&&b.$_cap_info[0]||{},f={});else{var l={};f={}}a.each(k,function(d,b){try{var c=e.find("[name="+b+"]"),m=f.locked&&f.locked[b];switch(typeof l[b]){case "string":"restriction"==b?(c.val(l[b]||""),""!=c.val()&&h.show()):(g.show(),h.hide());
case "undefined":if(c.is(":text")||c.is("textarea")||c.is("select"))(n||m)&&c.val(l[b]||""),m?c.prop("disabled",!0).attr("title","This field is locked by the template"):c.prop("disabled",!1).attr("title","");break;case "object":var q=["scope","addresses","codes"];for(d=0;d<q.length;d++)b==q[d]&&c.val(l[b]["@value"]||"");"incidents"==b&&(n||m)&&(c.val(l[b]["@value"]||""),a("select#cap_alert_incidents").multiselect("refresh"))}}catch(r){s3_debug("ERROR",r)}})}function k(e,d,b){if(e){"undefined"==typeof b&&
(b="template");var c=new RegExp(".*\\"+S3.Ap+"\\/");c=(new String(self.location)).replace(c,"").split("?")[0].split("/")[0];e=[S3.Ap,c,b,e].join("/")+".s3json";a.ajax({url:e,type:"GET",dataType:"json",success:function(a){n(a,d)},error:function(a){alert("There was an unexpected error loading template data")}})}}var h=a("#cap_alert_restriction__row, #cap_alert_restriction__row1"),g=a("#cap_alert_addresses__row, #cap_alert_addresses__row1");"Restricted"==a("#cap_alert_scope").val()?(h.show(),g.hide()):
("Public"==a("#cap_alert_scope").val()||"Private"==a("#cap_alert_scope").val()?g.show():g.hide(),h.hide());a("#cap_alert_scope").change(function(){switch(a(this).val()){case "Public":h.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");g.show();break;case "Restricted":g.hide();a("#cap_alert_addresses").val()&&a("#cap_alert_addresses").val("");h.show();break;case "Private":h.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");g.show();break;case "":g.hide(),
h.hide()}});a("#cap_info_priority").change(function(){if(a(this).val()){var b=S3.cap_priorities,d=b.length;"Undefined"==a(this).find("option:selected").text()&&(a(this).css("border","2px solid gray"),e.find("[name=urgency]").val(""),e.find("[name=severity]").val(""),e.find("[name=certainty]").val(""));for(var c=0;c<d;c++)b[c][0]==a(this).find("option:selected").text()&&(e.find("[name=urgency]").val(b[c][1]),e.find("[name=severity]").val(b[c][2]),e.find("[name=certainty]").val(b[c][3]),a(this).css("border",
"2px solid #"+b[c][4]))}else a(this).css("border","1px solid gray")});e.find("[name=template_id]").change(function(){k(a(this).val(),!0)});"cap_alert"!=d(e)||0<a(".cap_template_form").length||k(e.find("[name=template_id]").val());"cap_info"!=d(e)||b()||k(e.find("[name=template_info_id]").val(),!1,"info");window.apply_temp=k}function p(b){function f(){try{return a.parseJSON(b.find("[name=template_settings]").val())||{}}catch(h){return s3_debug("Error occured parsing: ",b.find("[name=template_settings]").val()),
{}}}function k(c,d){var g="can_edit-"+c,h=a('<label for="'+g+'">'+(i18n.cap_locked||"Locked")+"</label>");g=a('<input type="checkbox" name="'+g+'"/>');g.change(function(){var d=f();d.locked=d.locked||{};d.locked[c]=a(this).is(":checked");b.find("[name=template_settings]").val(e.stringify(d))});var k=f();k.locked&&k.locked[c]&&g.prop("checked","checked");d.append(h);d.append(g)}b.find("[name=is_template]").prop("checked","checked");tablename=d(b);fields=c(tablename);b.find("tr").each(function(){var b=
a(this),c=b.attr("id");c&&c.match("__row$")&&(c=c.replace(tablename+"_","").replace("__row",""),b=b.find("td.w2p_fc")||b.find("td").eq(1),0<=fields.indexOf(c)&&k(c,b))})}var u=function(){a(".cap-clone-update").unbind(".cap").bind("click.cap",function(){t(a(this).attr("data"))})},t=function(b){var c=b.split("/")[0];(b=b.split("/").pop())&&a.ajax({url:S3.Ap.concat("/cap/alert/")+b+"/clone?msg_type="+c,success:function(a){window.location.href=S3.Ap.concat("/cap/alert/")+a.message},error:function(a,b,
c){console.log("UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText)},type:"POST",dataType:"json"})};window.fields=c;a(document).ready(function(){a("form").each(function(){""!==d(a(this))&&(f(a(this)),(0<a(".cap_template_form").length||b())&&p(a(this)))});u()})})(jQuery,JSON,void 0);
