/*
 2019 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery UI MultiSelect Widget 1.14 by Eric Hynds
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var e=0;return function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){if(b==Array.prototype||b==Object.prototype)return b;b[e]=d.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<b.length;++e){var d=b[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,e){var d=$jscomp.propertyToPolyfillSymbol[e];if(null==d)return b[e];d=b[d];return void 0!==d?d:b[e]};
$jscomp.polyfill=function(b,e,d,a){e&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,e,d,a):$jscomp.polyfillUnisolated(b,e,d,a))};$jscomp.polyfillUnisolated=function(b,e,d,a){d=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var c=b[a];c in d||(d[c]={});d=d[c]}b=b[b.length-1];a=d[b];e=e(a);e!=a&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})};
$jscomp.polyfillIsolated=function(b,e,d,a){var c=b.split(".");b=1===c.length;a=c[0];a=!b&&a in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var l=0;l<c.length-1;l++){var k=c[l];k in a||(a[k]={});a=a[k]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?a[c]:null;e=e(d);null!=e&&(b?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:e}):e!==d&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):$jscomp.POLYFILL_PREFIX+c,c=$jscomp.propertyToPolyfillSymbol[c],
$jscomp.defineProperty(a,c,{configurable:!0,writable:!0,value:e})))};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(b){if(b)return b;var e=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};e.prototype.toString=function(){return this.$jscomp$symbol$id_};var d=0,a=function(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new e("jscomp_symbol_"+(c||"")+"_"+d++,c)};return a},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(b){if(b)return b;b=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),d=0;d<e.length;d++){var a=$jscomp.global[e[d]];"function"===typeof a&&"function"!=typeof a.prototype[b]&&$jscomp.defineProperty(a.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return b},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(b){b={next:b};b[Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,e){b instanceof String&&(b+="");var d=0,a={next:function(){if(d<b.length){var c=d++;return{value:e(c,b[c]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
(function(b,e){var d=0;b.widget("s3.cascadeSelect",{options:{multiple:!0,leafonly:!0,cascade:!0},_create:function(){this.id=d;d+=1;this.eventNamespace=".cascadeSelect"},_init:function(){var a=b(this.element);this.hiddenInput=b(".s3-cascade-input",a).first();this.refresh()},_destroy:function(){b.Widget.prototype.destroy.call(this)},refresh:function(){var a=b(this.element);this._unbindEvents();var c=[];b("select.s3-cascade-select",a).each(function(){c.push(b(this).empty().data("available",{}))});c.sort(function(a,
b){return a.data("level")-b.data("level")});this.selectors=c;a=this._getHierarchy();for(var e in a)this._addAvailableOption(null,0,e,a[e]);this._renderOptions(c[0],Object.keys(a),[]);e=this._deserialize();this._updateOptions(c[c.length-1],e);this._multiSelectInit();this._bindEvents()},get:function(){return this._deserialize()},set:function(a){this.reset();if(a){a.constructor!==Array&&(a=[a]);a=a.map(function(a){return""+a});var b=this.selectors;this._updateOptions(b[b.length-1],a);this._serialize();
return this}},reset:function(){this.selectors.forEach(function(a,c){a.val("");0<c&&b("option",a).remove();(a=a.multiselect("instance"))&&a.refresh()});this._serialize();this._toggleSelectors();return this},_deserialize:function(){var a=JSON.parse(this.hiddenInput.val());return a?a.map(function(a){return""+a}):[]},_serialize:function(){for(var a=this.options,b=[],e=this.selectors,d=e.length;d--;){var g=e[d],f=g.prop("multiple"),h=g.data("available");g=this._getSelected(g);for(var m=0,q=g.length;m<
q;m++){var n=g[m],p=h[n];if(!(!p||a.leafonly&&p[3])&&(-1==b.indexOf(n)&&b.push(n),b.length&&!f))break}if(b.length&&!f)break}this.hiddenInput.val(JSON.stringify(b)).trigger("select.s3hierarchy")},_multiSelectInit:function(){this.selectors.forEach(function(a){a.multiselect("instance")?a.multiselect("refresh"):a.prop("multiple")&&a.multiselect({})})},_getHierarchy:function(){var a=b(this).element,c=this.hierarchy;c===e&&(a=b(".s3-cascade",a),this.hierarchy=c=JSON.parse(a.val()));return c},_updateOptions:function(a,
b,d){var c=a.data("level"),g=a.data("available"),f=[];b=b.slice(0);this._getSelected(a).forEach(function(a){-1!=b.indexOf(a)||d&&-1==d.indexOf(a)||b.push(a)});if(0===c)this._setSelected(a,b);else if(d)this._renderOptions(a,d,b);else{var h=b.slice(0);b.forEach(function(a){a=g[a];a!==e&&-1==h.indexOf(a[0])&&h.push(a[0])});this._updateOptions(this.selectors[c-1],h)}if(0===c||d)a=this.selectors[c+1],a!==e?(b.forEach(function(a){a=g[a];a!==e&&(f=f.concat(Object.keys(a[3])))}),this._updateOptions(a,b,f)):
this._toggleSelectors()},_renderOptions:function(a,c,e){var d=this.options;!d.multiple&&d.cascade&&1==c.length&&(d=c[0],-1==e.indexOf(d)&&e.push(d));var g=a.data("available");a.empty();var f=[];c.forEach(function(a){var b=g[a];b&&f.push([a,b[1]])});f.sort(function(a,b){return a[1].localeCompare(b[1])});f.forEach(function(c){b("<option>").val(c[0]).text(c[1]).appendTo(a)});this._setSelected(a,e)},_getSelected:function(a){return(a=b(a).val())?a.constructor===Array?a.map(function(a){return""+a}):[""+
a]:[]},_setSelected:function(a,b){var c=a.data("available"),d=a.multiselect("instance");b=b.filter(function(a){return c[""+a]!==e});a.prop("multiple")?a.val(b):a.val(b[0]);d&&d.refresh()},_addAvailableOption:function(a,b,d,k){var c=this.selectors[b];if(c){var f=c.data("available");if(f===e||null===f)f={};f[""+d]=[""+a].concat(k);c.data("available",f);if((a=k[2])&&!0!==a)for(var h in a)this._addAvailableOption(d,b+1,h,a[h])}},_toggleSelectors:function(){this.selectors.forEach(function(a){var c=a.multiselect("instance");
b("option",a).length?(a.prop("disabled",!1),c&&c.enable()):(a.prop("disabled",!0),c&&c.disable())})},_hiddenBranches:function(a,c){var d=[],e=a.data("level");if(e=this.selectors[e+1]){var g=a.data("available"),f={};c.forEach(function(a){if((a=g[a])&&(a=a[3])&&!0!==a)for(var b in a)f[""+b]=!0});b("option",e).each(function(){f[b(this).val()]=!1});d=Object.keys(f).filter(function(a){return f[a]});d=d.concat(this._hiddenBranches(e,d))}return d},_bindEvents:function(){var a=b(this.element),c=this.eventNamespace,
d=this.options,e=this;b("select.s3-cascade-select",a).on("change"+c,function(){var a=b(this),c=e._getSelected(a);d.multiple&&d.cascade&&e._hiddenBranches(a,c).forEach(function(a){-1==c.indexOf(a)&&c.push(a)});e._updateOptions(a,c);e._serialize()});return!0},_unbindEvents:function(){var a=b(this.element),c=this.eventNamespace;b("select.s3-cascade-select",a).off(c);return!0}})})(jQuery);
